<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Klinik Terintegrasi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-top: 20px; }
        .service-card { border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .header-title { color: #2c3e50; font-weight: bold; margin-bottom: 30px; text-align: center; }
        .arrow-icon { font-size: 2rem; text-align: center; color: #7f8c8d; margin-top: 50px; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="header-title">Demo Tugas Akhir: Arsitektur Berbasis Layanan</h2>

    <div class="row">
        <div class="col-md-5">
            <div class="card service-card">
                <div class="card-header bg-primary text-white">
                    <h5>1. Registration Service</h5>
                    <small>Aktor: Pasien / Admin Pendaftaran</small>
                </div>
                <div class="card-body">
                    <form id="regForm">
                        <div class="mb-3">
                            <label class="form-label">Nama Pasien</label>
                            <input type="text" class="form-control" id="regName" placeholder="Contoh: Budi Santoso" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Umur</label>
                            <input type="number" class="form-control" id="regAge" placeholder="30" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Keluhan Utama</label>
                            <textarea class="form-control" id="regComplaint" rows="2" placeholder="Contoh: Demam tinggi"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Daftarkan Pasien</button>
                    </form>
                    
                    <div id="regResult" class="alert alert-success mt-3 d-none">
                        <strong>Sukses!</strong> ID Pasien: <span id="displayId" class="fw-bold"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-2 d-none d-md-block">
            <div class="arrow-icon">âž¡</div>
            <div class="text-center text-muted small">Data ID dikirim manual/sistem</div>
        </div>

        <div class="col-md-5">
            <div class="card service-card">
                <div class="card-header bg-success text-white">
                    <h5>2. Medical Service</h5>
                    <small>Aktor: Dokter</small>
                </div>
                <div class="card-body">
                    <form id="medForm">
                        <div class="mb-3">
                            <label class="form-label">ID Pasien (Validasi ke Service 1)</label>
                            <input type="text" class="form-control" id="medPatientId" placeholder="Masukkan ID dari hasil pendaftaran" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Diagnosa Dokter</label>
                            <input type="text" class="form-control" id="medDiagnosis" placeholder="Contoh: Flu Biasa" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Resep Obat</label>
                            <textarea class="form-control" id="medResep" rows="2" placeholder="Contoh: Paracetamol 3x1"></textarea>
                        </div>
                        <button type="submit" class="btn btn-success w-100">Simpan Rekam Medis</button>
                    </form>

                    <div id="medResult" class="alert mt-3 d-none"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. FUNGSI PENDAFTARAN
    document.getElementById('regForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const data = {
            name: document.getElementById('regName').value,
            age: document.getElementById('regAge').value,
            keluhan: document.getElementById('regComplaint').value
        };

        try {
            const response = await fetch('http://localhost:3000/api/registration/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await response.json();

            // Tampilkan Hasil
            const resultBox = document.getElementById('regResult');
            resultBox.classList.remove('d-none');
            document.getElementById('displayId').innerText = result.data.id;

            // UX: Otomatis copy ID ke form dokter
            document.getElementById('medPatientId').value = result.data.id;
            
        } catch (error) {
            alert("Gagal koneksi ke Registration Service (Pastikan server port 3001 jalan!)");
        }
    });

    // 2. FUNGSI DIAGNOSA
    document.getElementById('medForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const data = {
            patientId: document.getElementById('medPatientId').value,
            diagnosis: document.getElementById('medDiagnosis').value,
            resep: document.getElementById('medResep').value
        };

        const resultBox = document.getElementById('medResult');
        resultBox.className = 'alert mt-3'; // Reset class

        try {
            const response = await fetch('http://localhost:3000/api/medical/diagnose', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (response.ok) {
                // Sukses
                resultBox.classList.add('alert-success');
                resultBox.classList.remove('d-none');
                resultBox.innerHTML = `<strong>Berhasil!</strong><br>Diagnosa tersimpan. <br><small>Service 2 telah memvalidasi data ke Service 1.</small>`;
            } else {
                // Error (Misal ID Pasien Salah)
                resultBox.classList.add('alert-danger');
                resultBox.classList.remove('d-none');
                resultBox.innerHTML = `<strong>Gagal!</strong> ${result.message}`;
            }

        } catch (error) {
            alert("Gagal koneksi ke Medical Service (Pastikan server port 3002 jalan!)");
        }
    });
</script>

</body>
</html>